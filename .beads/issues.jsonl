{"id":"cobbler-6e3","title":"GH-25: bd ready returns empty after stitch timeout (stale task state)","description":"After a stitch timeout (the Claude process is killed at max_time_sec), the beads task enters a state where bd ready cannot find it, even though bd show \u003cid\u003e shows it as READY. This requires manual intervention to re-queue the task.\n\nRoot cause: resetTask(), recoverStaleBranches(), and resetOrphanedIssues() call bdUpdateStatus(id, \"ready\") but \"ready\" is not a valid beads status. The bd CLI silently accepts it, but bd ready only returns issues with status \"open\". The task becomes invisible.\n\nFix: Change \"ready\" to \"open\" in all three locations, add error handling, and add tests.\n\nGitHub: petar-djukic/cobbler-scaffold#25","status":"closed","priority":2,"issue_type":"epic","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T01:17:55Z","created_by":"petardjukic","updated_at":"2026-02-26T01:33:36Z","closed_at":"2026-02-26T01:33:36Z","close_reason":"Closed"}
{"id":"cobbler-6e3.2","title":"Fix status value and add error handling in task reset paths","description":"## Required Reading\n- pkg/orchestrator/stitch.go (resetTask, recoverStaleBranches, resetOrphanedIssues)\n- pkg/orchestrator/commands.go (bdUpdateStatus)\n\n## Files to Modify\n- pkg/orchestrator/stitch.go\n\n## Requirements\n1. Replace \"ready\" with \"open\" in all 3 bdUpdateStatus calls:\n   - Line 729: resetTask()\n   - Line 225: recoverStaleBranches()\n   - Line 261: resetOrphanedIssues()\n2. Add error checking in resetTask() — currently ignores return from bdUpdateStatus\n3. Add a constant (statusOpen = \"open\") to avoid repeated string literals\n4. Update the comment on line 22 that mentions \"ready\"\n\n## Design Decisions\n- Use a package-level constant for status strings to prevent future typos\n- Log warnings on bdUpdateStatus failure (don't fail hard — cleanup should continue)\n\n## Acceptance Criteria\n- All task reset paths use \"open\" status\n- resetTask logs warning if bdUpdateStatus fails\n- No string literal \"ready\" used as a beads status value\n- Code compiles: go build ./...","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T01:18:10Z","created_by":"petardjukic","updated_at":"2026-02-26T01:24:37Z","closed_at":"2026-02-26T01:24:37Z","close_reason":"Closed","dependencies":[{"issue_id":"cobbler-6e3.2","depends_on_id":"cobbler-6e3","type":"parent-child","created_at":"2026-02-25T20:18:10Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":1,"issue_id":"cobbler-6e3.2","author":"petardjukic","text":"tokens: 0","created_at":"2026-02-26T01:24:37Z"}]}
{"id":"cobbler-6e3.3","title":"Add tests for stitch timeout recovery","description":"## Required Reading\n- pkg/orchestrator/stitch.go (resetTask, resetOrphanedIssues, recoverStaleTasks)\n- tests/rel01.0/internal/testutil/testutil.go (CountReadyIssues, CreateIssue helpers)\n- Existing *_test.go files in pkg/orchestrator/\n\n## Files to Create/Modify\n- pkg/orchestrator/stitch_test.go (new or existing)\n\n## Requirements\n1. Test that resetTask sets status to \"open\" (verifiable via bd ready)\n2. Test that resetOrphanedIssues resets orphaned tasks to \"open\"\n3. Test that after reset, bd ready returns the task\n4. Test error case: verify logging when bdUpdateStatus fails\n\n## Design Decisions\n- Use bd CLI in tests (integration-style) since the code under test calls bd as external process\n- May need test helpers to initialize and tear down beads state\n\n## Acceptance Criteria\n- Tests pass: go test ./pkg/orchestrator/...\n- Tests cover the timeout → reset → bd ready cycle\n- No flaky tests (deterministic state setup/teardown)","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T01:18:18Z","created_by":"petardjukic","updated_at":"2026-02-26T01:33:04Z","closed_at":"2026-02-26T01:33:04Z","close_reason":"Closed","dependencies":[{"issue_id":"cobbler-6e3.3","depends_on_id":"cobbler-6e3","type":"parent-child","created_at":"2026-02-25T20:18:17Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":2,"issue_id":"cobbler-6e3.3","author":"petardjukic","text":"tokens: 0","created_at":"2026-02-26T01:33:03Z"}]}
{"id":"cobbler-cfn","title":"GH-38: generator:start and generator:stop should support non-main base branches","description":"generator:start enforces ensureOnBranch(\"main\") and generator:stop hardcodes gitCheckout(\"main\") as the merge target. This prevents running the generation pipeline on a feature branch.\n\nThe /git-issue-pop workflow creates a feature branch for each piece of work. Specifications are written on that branch, and the generation pipeline should run there too. The feature branch eventually merges into main via PR. But the current code forces the operator back to main for every generation run, breaking the feature-branch workflow.\n\nExpected: generator:start records the current branch as baseBranch and creates the generation branch from it. generator:stop merges back into the originating branch instead of hardcoded main.\n\nGitHub: petar-djukic/cobbler-scaffold#38","status":"closed","priority":2,"issue_type":"epic","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T02:37:59Z","created_by":"petardjukic","updated_at":"2026-02-26T03:03:33Z","closed_at":"2026-02-26T03:03:33Z","close_reason":"Closed"}
{"id":"cobbler-cfn.2","title":"Update PRD and specs for base branch support","description":"Type: documentation\n\nRequired Reading:\n- docs/specs/product-requirements/prd002-generation-lifecycle.yaml\n- docs/specs/use-cases/rel01.0-uc002-generation-lifecycle.yaml\n- docs/specs/test-suites/test-rel01.0.yaml\n- docs/ARCHITECTURE.yaml\n\nFiles to Modify:\n- docs/specs/product-requirements/prd002-generation-lifecycle.yaml\n- docs/specs/use-cases/rel01.0-uc002-generation-lifecycle.yaml (or create a new use case)\n- docs/specs/test-suites/test-rel01.0.yaml\n\nRequirements:\n1. Update PRD R2.1 from \"must verify the current branch is main\" to \"must record the current branch as the base branch\" (any clean branch is valid).\n2. Update PRD R5.3 from \"must switch to main\" to \"must switch to the recorded base branch\".\n3. Add requirements for storing and reading the base branch name.\n4. Update or add a use case covering the feature-branch generation workflow.\n5. Update the test suite to cover the new behavior.\n\nAcceptance Criteria:\n- PRD requirements no longer hardcode \"main\" for start/stop base branch behavior.\n- A use case describes the feature-branch generation lifecycle.\n- Test suite has test cases for starting from a non-main branch and stopping back to it.\n- mage analyze passes after changes.","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T02:38:33Z","created_by":"petardjukic","updated_at":"2026-02-26T02:42:54Z","closed_at":"2026-02-26T02:42:54Z","close_reason":"Closed","dependencies":[{"issue_id":"cobbler-cfn.2","depends_on_id":"cobbler-cfn","type":"parent-child","created_at":"2026-02-25T21:38:32Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":7,"issue_id":"cobbler-cfn.2","author":"petardjukic","text":"tokens: 45000","created_at":"2026-02-26T02:42:53Z"}]}
{"id":"cobbler-cfn.3","title":"Implement base branch recording in GeneratorStart/Stop","description":"Type: code\n\nRequired Reading:\n- pkg/orchestrator/generator.go (GeneratorStart, GeneratorStop, mergeGenerationIntoMain, ensureOnBranch)\n- pkg/orchestrator/commands.go (gitCurrentBranch, gitCheckout)\n- tests/rel01.0/uc002/lifecycle_test.go\n- docs/specs/product-requirements/prd002-generation-lifecycle.yaml (updated by sub-issue 1)\n\nFiles to Modify:\n- pkg/orchestrator/generator.go\n- tests/rel01.0/uc002/lifecycle_test.go\n\nRequirements:\n1. In GeneratorStart: replace ensureOnBranch(\"main\") with gitCurrentBranch(). Verify the branch is clean. Record the current branch name by writing it to .cobbler/base-branch on the generation branch (committed in the squash commit).\n2. In GeneratorStop: read .cobbler/base-branch from the generation branch. Use that value instead of hardcoded \"main\" for gitCheckout and merge target.\n3. Rename mergeGenerationIntoMain to mergeGeneration (or similar). Parameterize the target branch.\n4. Update log messages and commit messages to reference the base branch instead of \"main\".\n5. GeneratorReset keeps ensureOnBranch(\"main\") — no change.\n6. Update existing tests: TestRel01_UC002_StopMergesAndTags and TestRel01_UC002_StartStopStartAgain assert return to main because they start from main. Add a new test that starts from a feature branch, runs start/stop, and verifies return to the feature branch.\n7. All existing tests must continue to pass (main-based workflow is the default case).\n\nDesign Decisions:\n- Store base branch in .cobbler/base-branch (simple file, committed on generation branch, travels with the branch).\n- If .cobbler/base-branch is missing (backward compat with old generations), fall back to \"main\".\n\nAcceptance Criteria:\n- generator:start works from any clean branch and records it.\n- generator:stop merges back to the recorded base branch.\n- Existing main-based tests pass unchanged.\n- New test validates feature-branch workflow.\n- mage test:unit and mage test:local pass.","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T02:38:37Z","created_by":"petardjukic","updated_at":"2026-02-26T03:03:09Z","closed_at":"2026-02-26T03:03:09Z","close_reason":"Closed","dependencies":[{"issue_id":"cobbler-cfn.3","depends_on_id":"cobbler-cfn","type":"parent-child","created_at":"2026-02-25T21:38:37Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":8,"issue_id":"cobbler-cfn.3","author":"petardjukic","text":"tokens: 85000","created_at":"2026-02-26T03:03:08Z"}]}
{"id":"cobbler-qwj","title":"GH-33: Cross-generation differential comparison via mage compare","description":"Add a mage compare \u003ctag-A\u003e \u003ctag-B\u003e [utility] target that builds binaries from two git tags and runs differential tests between them. Enables cross-generation regression testing: comparing generation N against generation N+1, or any generation against GNU reference binaries.\n\nKey components:\n- BinaryResolver interface with GitTagResolver, GNUResolver, PathResolver implementations\n- Test case loader from YAML spec test suites\n- Comparison runner with structured pass/fail output\n- mage compare:run target\n\nGitHub: petar-djukic/cobbler-scaffold#33","status":"closed","priority":2,"issue_type":"epic","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T02:07:02Z","created_by":"petardjukic","updated_at":"2026-02-26T02:27:14Z","closed_at":"2026-02-26T02:27:14Z","close_reason":"All children completed"}
{"id":"cobbler-qwj.1","title":"PRD and use case for differential comparison","description":"## Required Reading\n- docs/VISION.yaml\n- docs/ARCHITECTURE.yaml\n- docs/constitutions/design.yaml (document_types: prd-format, use-case-format)\n- docs/road-map.yaml\n- docs/specs/product-requirements/prd001-orchestrator-core.yaml (pattern reference)\n- docs/specs/product-requirements/prd003-cobbler-workflows.yaml (pattern reference)\n- docs/specs/use-cases/rel01.0-uc004-stitch-workflow.yaml (pattern reference)\n- docs/engineering/golden-example-measure.yaml (references prd004)\n- docs/SPECIFICATIONS.yaml (notes prd004 gap)\n\n## Files to Create\n- docs/specs/product-requirements/prd004-differential-comparison.yaml\n- docs/specs/use-cases/rel03.0-uc001-cross-generation-comparison.yaml\n\n## Files to Modify\n- docs/road-map.yaml (add rel03.0 with uc001)\n\n## Requirements\n1. PRD covers: BinaryResolver interface, GitTag/GNU/Path resolver implementations, test case loading from YAML specs, comparison execution, structured output, worktree cleanup\n2. Use case covers: compare two generation tags, compare against GNU reference, single-utility comparison, structured result reporting\n3. Road-map updated with rel03.0 containing the new use case\n4. Fill the prd004 numbering gap noted in SPECIFICATIONS.yaml\n\n## Design Decisions\n- Follow existing PRD format (prd-format from design.yaml)\n- Number requirements R1-R6 covering: resolver interface, git tag resolution, GNU resolution, test case loading, comparison execution, output formatting\n- Use case follows existing pattern with preconditions, flow steps, success criteria, and touchpoints tracing to PRD requirements\n\n## Acceptance Criteria\n- mage analyze passes (no orphaned PRDs, use case in roadmap, traces valid)\n- PRD traces to VISION and ARCHITECTURE\n- Use case traces to PRD via touchpoints\n- road-map.yaml includes rel03.0","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T02:07:14Z","created_by":"petardjukic","updated_at":"2026-02-26T02:19:47Z","closed_at":"2026-02-26T02:19:47Z","close_reason":"Closed","dependencies":[{"issue_id":"cobbler-qwj.1","depends_on_id":"cobbler-qwj","type":"parent-child","created_at":"2026-02-25T21:07:14Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":3,"issue_id":"cobbler-qwj.1","author":"petardjukic","text":"tokens: 0","created_at":"2026-02-26T02:19:46Z"}]}
{"id":"cobbler-qwj.2","title":"BinaryResolver interface and implementations","description":"## Required Reading\n- docs/specs/product-requirements/prd004-differential-comparison.yaml (created in sub-issue 1)\n- pkg/orchestrator/commands.go (git worktree wrappers: gitWorktreeAdd, gitWorktreeRemove)\n- pkg/orchestrator/build.go (go build patterns)\n- pkg/orchestrator/config.go (Config struct, project settings)\n- pkg/orchestrator/stitch.go (worktree lifecycle pattern)\n\n## Files to Create\n- pkg/orchestrator/compare.go\n\n## Requirements\n1. BinaryResolver interface: Resolve(utility string) (path string, cleanup func(), err error)\n2. GitTagResolver{Tag string}: creates temp worktree from git tag, discovers cmd/ packages, builds each with go build, returns binary path. cleanup removes worktree and temp build dir.\n3. GNUResolver{}: resolves Homebrew reference binaries via exec.LookPath. Coreutils use g-prefix (cat-\u003egcat, wc-\u003egwc). Moreutils use unprefixed names (ts-\u003ets, sponge-\u003esponge). Returns binary path on PATH; cleanup is no-op.\n4. PathResolver{Dir string}: resolves pre-built binaries from a directory. Returns filepath.Join(Dir, utility); cleanup is no-op.\n5. ResolverFromArg(arg string) BinaryResolver: factory that selects resolver based on argument — \"gnu\" -\u003e GNUResolver, directory path -\u003e PathResolver, otherwise -\u003e GitTagResolver.\n6. ListUtilities(resolver BinaryResolver) ([]string, error): discovers available utilities for a resolver.\n\n## Design Decisions\n- Use existing gitWorktreeAdd/Remove from commands.go for worktree lifecycle\n- GitTagResolver builds into a temp directory (os.MkdirTemp), not into the worktree itself\n- GNUResolver maintains a map of utility -\u003e binary name for the g-prefix convention\n- cleanup functions are idempotent (safe to call multiple times)\n\n## Acceptance Criteria\n- All three resolvers compile and handle errors with wrapped context\n- GitTagResolver creates and cleans up worktrees\n- GNUResolver resolves coreutils and moreutils correctly\n- PathResolver validates binary exists at path\n- Code compiles: go build ./...","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T02:07:29Z","created_by":"petardjukic","updated_at":"2026-02-26T02:21:04Z","closed_at":"2026-02-26T02:21:04Z","close_reason":"Closed","dependencies":[{"issue_id":"cobbler-qwj.2","depends_on_id":"cobbler-qwj","type":"parent-child","created_at":"2026-02-25T21:07:29Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":4,"issue_id":"cobbler-qwj.2","author":"petardjukic","text":"tokens: 0","created_at":"2026-02-26T02:21:03Z"}]}
{"id":"cobbler-qwj.3","title":"Test case loader and comparison runner","description":"## Required Reading\n- docs/specs/product-requirements/prd004-differential-comparison.yaml\n- docs/specs/test-suites/test-rel01.0.yaml (test suite YAML structure)\n- pkg/orchestrator/context.go (YAML loading patterns)\n- pkg/orchestrator/compare.go (BinaryResolver interface, created in sub-issue 2)\n\n## Files to Create\n- pkg/orchestrator/testloader.go\n\n## Requirements\n1. TestCase struct modeling a test case from YAML specs: name, utility, stdin input, args, expected stdout, expected stderr, expected exit code.\n2. LoadTestCases(specsDir string) ([]TestCase, error): reads test suite YAML files from docs/specs/test-suites/, extracts test cases with inputs and expected outputs. Filters to cases that have concrete inputs/expected (skips Go-test-only entries).\n3. FilterByUtility(cases []TestCase, utility string) []TestCase: filters test cases to a single utility.\n4. CompareUtility(binA, binB string, cases []TestCase) []TestResult: runs both binaries with identical inputs for each test case, compares stdout byte-for-byte, stderr, and exit code.\n5. TestResult struct: utility, test name, passed bool, expected/actual diffs for stdout/stderr/exit code.\n6. FormatResults(results []TestResult) string: structured text output showing pass/fail per utility per test case with summary counts.\n\n## Design Decisions\n- Test cases loaded from YAML specs (not from _test.go files) so any two implementations can be compared\n- Comparison is byte-for-byte on stdout; stderr and exit code compared separately\n- Each test case executed with a timeout (configurable, default 10s)\n- Results collected in memory, formatted at the end (not streamed)\n\n## Acceptance Criteria\n- Loader parses existing test-rel01.0.yaml structure\n- CompareUtility produces correct pass/fail for matching and differing outputs\n- FormatResults produces readable structured output\n- Code compiles: go build ./...","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T02:07:44Z","created_by":"petardjukic","updated_at":"2026-02-26T02:24:18Z","closed_at":"2026-02-26T02:24:18Z","close_reason":"Closed","dependencies":[{"issue_id":"cobbler-qwj.3","depends_on_id":"cobbler-qwj","type":"parent-child","created_at":"2026-02-25T21:07:43Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":5,"issue_id":"cobbler-qwj.3","author":"petardjukic","text":"tokens: 12000","created_at":"2026-02-26T02:24:18Z"}]}
{"id":"cobbler-qwj.4","title":"Mage target, orchestrator method, and tests","description":"## Required Reading\n- docs/specs/product-requirements/prd004-differential-comparison.yaml\n- magefiles/magefile.go (namespace pattern, newOrch(), target signatures)\n- pkg/orchestrator/orchestrator.go (Orchestrator struct, public methods)\n- pkg/orchestrator/compare.go (BinaryResolver, resolvers)\n- pkg/orchestrator/testloader.go (LoadTestCases, CompareUtility, FormatResults)\n\n## Files to Create\n- pkg/orchestrator/compare_test.go\n\n## Files to Modify\n- magefiles/magefile.go (add Compare namespace and Run target)\n\n## Requirements\n1. Compare method on Orchestrator: Compare(tagA, tagB, utility string) error\n   - Creates resolvers for both arguments via ResolverFromArg\n   - Loads test cases from specs dir\n   - Optionally filters by utility\n   - Discovers utilities from both resolvers, intersects to find common set\n   - For each common utility: resolves both binaries, runs comparison, collects results\n   - Cleans up all resolver resources (deferred)\n   - Formats and prints results; returns error if any test failed\n2. Compare mage namespace with Run target:\n   type Compare mg.Namespace\n   func (Compare) Run(tagA, tagB string) error — compares all utilities\n   Utility filtering via environment variable or additional target\n3. Unit tests for:\n   - PathResolver (create temp binaries, verify resolution)\n   - GNUResolver (verify g-prefix mapping for known utilities)\n   - ResolverFromArg (factory selection logic)\n   - FormatResults (output formatting)\n4. Integration test (if git available): GitTagResolver with a known tag\n\n## Design Decisions\n- Compare method lives on Orchestrator for access to config (specs dir, source dirs)\n- Mage target uses environment variable UTILITY for single-utility filtering (mage limitation: no optional positional args)\n- Tests use PathResolver with temp dirs to avoid git/build dependencies in unit tests\n- Integration tests gated on environment (skip if no git repo)\n\n## Acceptance Criteria\n- go build ./... passes\n- go test ./pkg/orchestrator/ passes (new tests)\n- mage -l shows compare:run target\n- mage compare:run \u003ctagA\u003e \u003ctagB\u003e executes end-to-end (manual verification)","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-26T02:08:00Z","created_by":"petardjukic","updated_at":"2026-02-26T02:26:29Z","closed_at":"2026-02-26T02:26:29Z","close_reason":"Closed","dependencies":[{"issue_id":"cobbler-qwj.4","depends_on_id":"cobbler-qwj","type":"parent-child","created_at":"2026-02-25T21:08:00Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":6,"issue_id":"cobbler-qwj.4","author":"petardjukic","text":"tokens: 15000","created_at":"2026-02-26T02:26:28Z"}]}
