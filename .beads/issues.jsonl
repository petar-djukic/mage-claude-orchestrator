{"id":"mage-04l","title":"GH-12: Single-turn measure to eliminate thinking token variance","description":"The measure step currently takes 2 turns: the model thinks and writes the YAML file via the Write tool (turn 1), then produces a summary after the tool result (turn 2). Turn 1's thinking tokens get fed back as input context for turn 2, causing non-deterministic input token counts across runs even though the prompt is identical.\n\nInstruct the model to return the YAML as text output instead of using the Write tool. The orchestrator captures the YAML directly and writes the file itself. This eliminates the Write tool round trip (no turn 2), thinking token accumulation across turns, and input token variance from prior-turn context.\n\nAcceptance Criteria:\n- Measure completes in a single turn (no tool calls)\n- The orchestrator captures YAML from the model's text output and writes the file\n- Input token counts are identical across runs with the same specs\n- Output token variance is limited to thinking block and YAML content only\n\nGitHub: petar-djukic/cobbler-scaffold#12","status":"open","priority":2,"issue_type":"epic","owner":"petar.djukic@gmail.com","created_at":"2026-02-25T03:59:19Z","created_by":"petardjukic","updated_at":"2026-02-25T03:59:19Z"}
{"id":"mage-04l.1","title":"Update measure prompt to return YAML as text output","description":"deliverable_type: code\n\nrequired_reading:\n  - pkg/orchestrator/prompts/measure.yaml\n  - pkg/orchestrator/measure.go\n  - pkg/orchestrator/prompt.go\n\nfiles:\n  - path: pkg/orchestrator/prompts/measure.yaml\n    action: modify\n    note: Remove Write tool instructions and output_path references; instruct Claude to return YAML as text output\n\nrequirements:\n  - id: R1\n    text: Remove all instructions referencing the Write tool from the measure prompt\n  - id: R2\n    text: Remove output_path placeholder usage from the prompt template\n  - id: R3\n    text: Add instructions for Claude to return the YAML list as text output (no tool calls)\n  - id: R4\n    text: Set max_turns to 1 or equivalent in the prompt to enforce single-turn behavior\n  - id: R5\n    text: Preserve the existing YAML schema for proposed issues (index, title, dependency, description)\n\ndesign_decisions:\n  - id: D1\n    text: Use a YAML fenced code block in text output for unambiguous extraction by the orchestrator\n\nacceptance_criteria:\n  - id: AC1\n    text: Prompt does not reference the Write tool or output_path\n  - id: AC2\n    text: Prompt instructs Claude to return YAML as text\n  - id: AC3\n    text: The YAML schema for proposed issues is unchanged\n  - id: AC4\n    text: No tool calls are expected from Claude during measure","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-25T03:59:32Z","created_by":"petardjukic","updated_at":"2026-02-25T03:59:32Z","dependencies":[{"issue_id":"mage-04l.1","depends_on_id":"mage-04l","type":"parent-child","created_at":"2026-02-24T22:59:32Z","created_by":"petardjukic","metadata":"{}"}]}
{"id":"mage-04l.2","title":"Update measure orchestrator to capture YAML from text output","description":"deliverable_type: code\n\nrequired_reading:\n  - pkg/orchestrator/measure.go\n  - pkg/orchestrator/cobbler.go\n  - pkg/orchestrator/prompt.go\n\nfiles:\n  - path: pkg/orchestrator/measure.go\n    action: modify\n    note: Extract YAML from ClaudeResult.RawOutput instead of reading file written by Claude; write the YAML file from orchestrator side\n  - path: pkg/orchestrator/cobbler.go\n    action: modify\n    note: Add or update YAML extraction helper to parse YAML from Claude text output; enforce max-turns 1 for measure invocations\n  - path: pkg/orchestrator/prompt.go\n    action: modify\n    note: Remove output_path placeholder from MeasurePromptData and buildMeasurePrompt if needed\n\nrequirements:\n  - id: R1\n    text: Extract YAML content from ClaudeResult.RawOutput (text output from Claude)\n  - id: R2\n    text: Write the extracted YAML to the output file from the orchestrator (not Claude)\n  - id: R3\n    text: Remove output_path placeholder from buildMeasurePrompt\n  - id: R4\n    text: Enforce max-turns 1 in the Claude invocation for measure calls\n  - id: R5\n    text: Handle edge cases where Claude output does not contain valid YAML (error reporting)\n  - id: R6\n    text: Preserve existing history artifact saving (prompt, log, stats, issues files)\n\ndesign_decisions:\n  - id: D1\n    text: Parse YAML from fenced code block if present; fall back to raw text extraction\n  - id: D2\n    text: Use --max-turns 1 flag in runClaude for measure to prevent multi-turn behavior\n\nacceptance_criteria:\n  - id: AC1\n    text: Orchestrator successfully extracts YAML from Claude text output\n  - id: AC2\n    text: Orchestrator writes the YAML file (Claude does not write it)\n  - id: AC3\n    text: output_path placeholder is removed from prompt building\n  - id: AC4\n    text: Measure completes in a single Claude API turn\n  - id: AC5\n    text: History artifacts are saved correctly\n  - id: AC6\n    text: Error messages are clear when YAML extraction fails","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-25T03:59:47Z","created_by":"petardjukic","updated_at":"2026-02-25T03:59:47Z","dependencies":[{"issue_id":"mage-04l.2","depends_on_id":"mage-04l","type":"parent-child","created_at":"2026-02-24T22:59:47Z","created_by":"petardjukic","metadata":"{}"}]}
{"id":"mage-04l.3","title":"Update measure tests for single-turn behavior","description":"deliverable_type: code\n\nrequired_reading:\n  - pkg/orchestrator/measure_test.go\n  - tests/rel01.0/uc003/measure_test.go\n  - tests/rel01.0/uc003/measure_claude_test.go\n\nfiles:\n  - path: pkg/orchestrator/measure_test.go\n    action: modify\n    note: Update unit tests for YAML extraction from text output\n  - path: tests/rel01.0/uc003/measure_test.go\n    action: modify\n    note: Update integration tests for single-turn measure behavior\n  - path: tests/rel01.0/uc003/measure_claude_test.go\n    action: modify\n    note: Update Claude-dependent tests to verify single-turn execution\n\nrequirements:\n  - id: R1\n    text: Update unit tests to test YAML extraction from text output (fenced code block and raw text)\n  - id: R2\n    text: Update integration tests to verify measure completes without tool calls\n  - id: R3\n    text: Add test for edge case where Claude output contains no valid YAML\n  - id: R4\n    text: Verify existing validation tests (P7, P9) still pass with the new extraction path\n  - id: R5\n    text: Update Claude-dependent tests to confirm single-turn behavior\n\nacceptance_criteria:\n  - id: AC1\n    text: All existing measure tests pass with the new implementation\n  - id: AC2\n    text: At least one test validates YAML extraction from text output\n  - id: AC3\n    text: At least one test validates error handling for missing YAML\n  - id: AC4\n    text: Claude-dependent tests verify single-turn execution (no tool calls)","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-25T03:59:59Z","created_by":"petardjukic","updated_at":"2026-02-25T03:59:59Z","dependencies":[{"issue_id":"mage-04l.3","depends_on_id":"mage-04l","type":"parent-child","created_at":"2026-02-24T22:59:58Z","created_by":"petardjukic","metadata":"{}"}]}
{"id":"mage-1yh","title":"Measure output is non-deterministic across runs","description":"Two runs of cobbler:measure against the same project state produce different issues. The root cause is that the prompt gives Claude freedom on decisions that should be pinned in specifications.\n\nObserved differences between runs:\n- File naming (difftest.go vs testutils.go)\n- Struct shape (*FileExpectation vs map[string][]byte)\n- Timeout configurability choices\n- Requirement granularity (9 requirements vs 6)\n\n## Required fixes (ordered by impact)\n\n### 1. Pin design decisions in specs, not the prompt (highest impact)\nThe PRD leaves implementation choices open (file names, struct shapes, timeout config). The measure agent invents them differently each time. Fix: add these decisions to the PRD or use case directly. If prd001-testutils.yaml specifies \"the main file is difftest.go\" and \"use a FileExpectation struct, not a map\", Claude has nothing to invent.\n\n### 2. Add a golden example for the target utility\nThe prompt has a generic abstract example (ExampleType, pkg/types/example.go). A domain-specific example — a completed measure-issues.yaml from a previous successful generation — would anchor the style, granularity, and naming conventions. Add an examples field to the prompt that includes an actual previous approved issue.\n\n### 3. Constrain requirement granularity in planning constitution\nThe planning constitution (P2) constrains lines of code and file count, but says nothing about how many requirements or acceptance criteria to produce. One run gave 9 requirements, the other gave 6. Add a rule like \"target 5-8 requirements per code task\" to reduce this axis of variation.\n\n### 4. Prescribe file naming conventions\nNeither the prompt nor the constitution tells the model what to name Go source files. Add a rule to the planning constitution or a design decision in the PRD: \"name the main source file after the primary exported type or function, not the package name.\"\n\n### 5. Lower temperature (if the orchestrator supports it)\nThe orchestrator calls Claude via CLI. If it passes through API parameters, setting temperature: 0 would reduce randomness. This won't eliminate variance but helps.\n\n### 6. Post-hoc validation / schema enforcement\nAdd a validation step after measure that checks the output against a stricter schema — e.g., file names must match a pattern, struct form not map, requirement count within range. Reject and re-run if it doesn't conform.\n\n## Files to modify\n- pkg/orchestrator/measure.go — add temperature parameter, validation step\n- Default prompt templates (prompts/measure.yaml) — add golden example field\n- Default constitution (constitutions/planning.yaml) — add requirement granularity and file naming rules\n\n## Acceptance criteria\n- [ ] Two consecutive runs of measure against the same project state produce structurally equivalent issues\n- [ ] File names, struct shapes, and requirement counts are consistent\n- [ ] Golden example mechanism implemented and documented","status":"closed","priority":1,"issue_type":"bug","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T03:46:27Z","created_by":"petardjukic","updated_at":"2026-02-24T03:53:23Z","closed_at":"2026-02-24T03:53:23Z","close_reason":"Closed"}
{"id":"mage-2rk","title":"Implement issue tracker tree view","description":"Implement a TreeDataProvider for the mageOrchestrator.issues view declared in package.json. The view should display beads issues grouped by status (open/closed), showing title, priority, and labels. Depends on the beads JSONL parser (mage-p2y) being implemented first.","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T20:00:52Z","created_by":"petardjukic","updated_at":"2026-02-24T19:16:08Z","closed_at":"2026-02-24T19:16:08Z","close_reason":"Closed"}
{"id":"mage-3a3","title":"Implement spec browser data layer (specModel.ts)","description":"deliverable_type: code\noutput: vscode-extension/src/specModel.ts\n\nRequired Reading:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (R8: Specification Browser)\n- docs/specs/use-cases/rel02.0-uc006-specification-browser.yaml\n- docs/specs/use-cases/*.yaml (example YAML structure to parse)\n- docs/specs/product-requirements/*.yaml (example PRD YAML structure to parse)\n\nFiles to Create:\n- vscode-extension/src/specModel.ts\n\nRequirements:\n- Read and parse docs/specs/use-cases/*.yaml, docs/specs/product-requirements/*.yaml, docs/specs/test-suites/*.yaml using js-yaml or vscode.workspace.fs\n- Build in-memory SpecGraph: use cases indexed by id, PRDs indexed by id, touchpoints linking use cases to PRD requirement IDs\n- SpecGraph.getUseCase(id), .getPrd(id), .listUseCases(), .listPrds(), .listTestSuites()\n- SpecGraph.getSourceFiles(prdId): grep pkg/ and magefiles/ for occurrences of the PRD ID string, return [{file, line}]\n- Cache the graph; invalidate when FileSystemWatcher fires on docs/specs/\n- Export SpecGraph class and SpecNode types (UseCase, Prd, TestSuite, Touchpoint, SourceRef)\n\nAcceptance Criteria:\n- specModel.ts compiles with tsc (no type errors)\n- SpecGraph correctly parses the existing use-case and PRD YAML files\n- getSourceFiles returns file paths and line numbers where PRD IDs appear\n- Cache invalidation clears and rebuilds when docs/specs/ changes","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T13:45:46Z","created_by":"petardjukic","updated_at":"2026-02-23T17:53:41Z","closed_at":"2026-02-23T17:53:41Z","close_reason":"Closed"}
{"id":"mage-3m6","title":"Implement spec browser tree view (specBrowser.ts)","description":"deliverable_type: code\noutput: vscode-extension/src/specBrowser.ts\n\nRequired Reading:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (R8)\n- docs/specs/use-cases/rel02.0-uc006-specification-browser.yaml\n- vscode-extension/src/specModel.ts (SpecGraph API, must exist first)\n- vscode-extension/src/extension.ts (how to register TreeDataProvider)\n\nFiles to Create/Modify:\n- vscode-extension/src/specBrowser.ts (create)\n- vscode-extension/src/extension.ts (register SpecBrowserProvider)\n- vscode-extension/package.json (add mage-orchestrator.specs view to activitybar)\n\nRequirements:\n- SpecBrowserProvider implements vscode.TreeDataProvider\u003cSpecTreeItem\u003e\n- Root nodes: 'Use Cases', 'Requirements', 'Test Suites'\n- Use Cases children: one node per use case (id + title), expanding to show touchpoints\n- Each touchpoint node links to the referenced PRD requirement\n- Each requirement node expands to show source file refs from SpecGraph.getSourceFiles()\n- Clicking a spec node opens the YAML file: vscode.window.showTextDocument(uri)\n- Clicking a source ref opens the file at the correct line: vscode.window.showTextDocument(uri, {selection: range})\n- refresh() method called when SpecGraph cache invalidates\n\nAcceptance Criteria:\n- Tree view appears in VS Code activity bar\n- Use cases list matches docs/specs/use-cases/*.yaml\n- Expanding a use case shows its touchpoint requirement links\n- Clicking a source ref opens the correct file at the correct line\n- Tree refreshes when docs/specs/ files change","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T13:45:57Z","created_by":"petardjukic","updated_at":"2026-02-23T17:59:27Z","closed_at":"2026-02-23T17:59:27Z","close_reason":"Closed"}
{"id":"mage-4lk","title":"Unit tests for selective context and context budget","description":"deliverable_type: code\n\nrequired_reading:\n  - pkg/orchestrator/context.go (filterSourceFiles, applyContextBudget)\n  - pkg/orchestrator/stitch.go (buildStitchPrompt, required_reading parsing)\n  - pkg/orchestrator/context_test.go (existing test patterns)\n  - pkg/orchestrator/cobbler_test.go (existing test patterns)\n\nfiles:\n  - path: pkg/orchestrator/context_test.go\n    action: modify\n    note: Add tests for filterSourceFiles and applyContextBudget\n  - path: pkg/orchestrator/cobbler_test.go\n    action: modify\n    note: Add tests for required_reading parsing if logic lives in cobbler.go\n\nrequirements:\n  - id: R1\n    text: Test filterSourceFiles with exact path matches returns only matching files.\n  - id: R2\n    text: Test filterSourceFiles with suffix matching (e.g., \"foo.go\" matches \"pkg/bar/foo.go\").\n  - id: R3\n    text: Test filterSourceFiles with empty required list returns all files (fallback behavior).\n  - id: R4\n    text: Test filterSourceFiles strips parenthetical notes from paths before matching.\n  - id: R5\n    text: Test applyContextBudget removes non-required source files when over budget.\n  - id: R6\n    text: Test applyContextBudget is a no-op when budget is 0.\n  - id: R7\n    text: Test applyContextBudget preserves required files even when over budget.\n\nacceptance_criteria:\n  - id: AC1\n    text: All new tests pass via go test ./pkg/orchestrator/...\n  - id: AC2\n    text: All existing tests continue to pass.\n  - id: AC3\n    text: Tests cover both happy path and edge cases (empty input, all files required, budget exactly at limit).","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T20:57:57Z","created_by":"petardjukic","updated_at":"2026-02-24T21:11:59Z","closed_at":"2026-02-24T21:11:59Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-4lk","depends_on_id":"mage-65l","type":"blocks","created_at":"2026-02-24T15:58:00Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":8,"issue_id":"mage-4lk","author":"petardjukic","text":"tokens: 65000","created_at":"2026-02-24T21:11:58Z"}]}
{"id":"mage-65l","title":"GH-4: Phase 3: Cobbler-scaffold prompt engineering (selective stitch context)","description":"Implement eng05 recommendations as code changes. Selective stitch context, context budget, task splitting guidance, and E2E validation.\n\nTasks:\n1. Selective stitch context (eng05 rec D): Modify buildStitchPrompt in stitch.go to parse required_reading from the task description and include only those files, falling back to full context if empty\n2. Context budget: Add max_context_bytes config option; truncate non-required source files when exceeded\n3. Task splitting guidance: Update planning constitution to explicitly split implementation and test tasks\n4. E2E test: Create test that runs measure+stitch against go-unix-utils spec structure and validates compilation\n\nKey files:\n- pkg/orchestrator/stitch.go (buildStitchPrompt)\n- pkg/orchestrator/context.go (buildProjectContext, loadSourceFiles)\n- pkg/orchestrator/config.go (CobblerConfig)\n- pkg/orchestrator/constitutions/planning.yaml\n\nValidation gate: Measure+stitch produces compiling code for 2 sequential tasks.\n\nGitHub: petar-djukic/cobbler-scaffold#4","status":"closed","priority":2,"issue_type":"epic","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T20:57:02Z","created_by":"petardjukic","updated_at":"2026-02-24T21:22:40Z","closed_at":"2026-02-24T21:22:40Z","close_reason":"Closed"}
{"id":"mage-6ul","title":"Add R10 Extension Build and Installation to prd006","description":"deliverable_type: documentation\nformat_rule: prd-format (update existing)\noutput_path: docs/specs/product-requirements/prd006-vscode-extension.yaml\n\nRequired Reading:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (full)\n- docs/constitutions/design.yaml (prd-format rules)\n\nFiles to Modify:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml\n\nRequirements:\nAdd G7 goal for extension build and installation via mage targets. Add R10 requirement group with:\n- R10.1: mage vscode:push must compile TypeScript, package as .vsix, and install into VS Code\n- R10.2: Push must run npm install in the extension directory before compiling\n- R10.3: Push must verify required tools (npm, code CLI) are available before proceeding\n- R10.4: mage vscode:pop must uninstall the extension from VS Code using the code CLI\n- R10.5: Push must log each step (dependency install, compile, package, install) via the orchestrator logging pattern\n\nAdd corresponding acceptance criteria for push/pop targets.\n\nAcceptance Criteria:\n- R10 added to prd006 in correct prd-format structure\n- G7 added to goals list\n- R10 describes full push flow (verify tools, npm install, compile, package, install)\n- R10 describes pop flow (uninstall via code CLI)\n- Acceptance criteria updated with push/pop verification\n- mage analyze passes after update","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T14:16:59Z","created_by":"petardjukic","updated_at":"2026-02-23T14:22:07Z","closed_at":"2026-02-23T14:22:07Z","close_reason":"Closed"}
{"id":"mage-83v","title":"GH-14: Investigate and fix slow test:usecase execution time","description":"mage test:usecase takes a very long time to complete. We need to identify which test(s) are causing the slowdown and why, then fix or restructure them so the suite runs in a reasonable time.\n\nAcceptance Criteria:\n- Profile mage test:usecase to identify which test(s) consume the most time\n- Document the root cause of the slowness (e.g., unnecessary waits, heavy setup, serial execution of parallelizable work)\n- Reduce total test:usecase execution time to a reasonable duration\n- No long-running tests without justification — tests that require external services (e.g., Claude API) should be clearly marked and skippable\n\nGitHub: petar-djukic/cobbler-scaffold#14","status":"closed","priority":2,"issue_type":"epic","owner":"petar.djukic@gmail.com","created_at":"2026-02-25T03:34:07Z","created_by":"petardjukic","updated_at":"2026-02-25T03:46:21Z","closed_at":"2026-02-25T03:46:21Z","close_reason":"All children completed"}
{"id":"mage-83v.1","title":"Profile test:usecase and identify slow tests","description":"deliverable_type: code\n\nRequired Reading:\n- magefiles/magefile.go (test targets)\n- tests/rel01.0/uc001/init_test.go\n- tests/rel01.0/uc002/lifecycle_test.go\n- tests/rel01.0/uc003/measure_test.go\n- tests/rel01.0/uc004/stitch_test.go\n- tests/rel01.0/uc005/resume_test.go\n- tests/rel01.0/uc006/scaffold_test.go\n- tests/rel01.0/uc007/build_test.go\n- tests/rel01.0/internal/testutil/testutil.go\n\nFiles to Modify:\n- magefiles/magefile.go (add verbose timing target)\n\nRequirements:\n- Run go test with -v and -count=1 to capture per-test durations for the usecase suite\n- Categorize every test as \"local-only\" or \"Claude-dependent\" based on whether it calls SetupClaude or invokes cobbler:measure/cobbler:stitch/generator:run\n- Document findings: which tests are slow, why, and their category\n\nAcceptance Criteria:\n- Per-test timing data captured and analyzed\n- Each test categorized as local-only or Claude-dependent\n- Root causes of slowness documented (Claude API latency ~150s per call, snapshot setup, etc.)","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-25T03:34:16Z","created_by":"petardjukic","updated_at":"2026-02-25T03:39:51Z","closed_at":"2026-02-25T03:39:51Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-83v.1","depends_on_id":"mage-83v","type":"parent-child","created_at":"2026-02-24T22:34:16Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":15,"issue_id":"mage-83v.1","author":"petardjukic","text":"tokens: 50000","created_at":"2026-02-25T03:39:50Z"}]}
{"id":"mage-83v.2","title":"Separate Claude-dependent tests and add fast local target","description":"deliverable_type: code\n\nRequired Reading:\n- tests/rel01.0/uc002/lifecycle_test.go\n- tests/rel01.0/uc003/measure_test.go\n- tests/rel01.0/uc004/stitch_test.go\n- tests/rel01.0/internal/testutil/testutil.go\n- magefiles/magefile.go\n- docs/constitutions/testing.yaml\n\nFiles to Modify:\n- tests/rel01.0/uc003/measure_test.go (gate Claude tests behind claude build tag)\n- tests/rel01.0/uc004/stitch_test.go (gate Claude tests behind claude build tag)\n- tests/rel01.0/uc002/lifecycle_test.go (gate RunOneCycle behind claude build tag)\n- magefiles/magefile.go (add test:usecase:local target)\n\nRequirements:\n- Add a \"claude\" build tag to tests that require Claude API access\n- Keep the \"usecase\" tag on all use case tests so test:usecase still runs everything\n- Add a test:usecase:local mage target that runs only usecase-tagged tests WITHOUT the claude tag\n- Add comments to each Claude-dependent test explaining the dependency\n- Ensure test:usecase:local completes in under 60 seconds\n\nDesign Decisions:\n- Use build tag \"claude\" (not \"integration\" or \"slow\") to be explicit about the dependency\n- Tests get both tags: \"//go:build usecase \u0026\u0026 claude\" for Claude tests, \"//go:build usecase\" for local tests\n- test:usecase runs with \"-tags usecase,claude\" (existing behavior preserved)\n- test:usecase:local runs with \"-tags usecase\" only (excludes claude-tagged tests)\n\nAcceptance Criteria:\n- mage test:usecase:local runs in under 60 seconds with no Claude dependency\n- mage test:usecase still runs the full suite including Claude tests (backward compatible)\n- Each Claude-dependent test file has build tag \"//go:build usecase \u0026\u0026 claude\"\n- Each Claude-dependent test has a comment explaining why it needs Claude\n- Unit tests pass (mage test:unit)\n- No test regressions in the local suite","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-25T03:34:27Z","created_by":"petardjukic","updated_at":"2026-02-25T03:46:00Z","closed_at":"2026-02-25T03:46:00Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-83v.2","depends_on_id":"mage-83v","type":"parent-child","created_at":"2026-02-24T22:34:27Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":16,"issue_id":"mage-83v.2","author":"petardjukic","text":"tokens: 70000","created_at":"2026-02-25T03:45:59Z"}]}
{"id":"mage-90d","title":"GH-3: Fix measure output non-determinism across runs","description":"Two runs of cobbler:measure against the same project state produce different issues. The root cause is that the prompt gives Claude freedom on decisions that should be pinned in specifications.\n\nObserved differences between runs:\n- File naming (difftest.go vs testutils.go)\n- Struct shape (*FileExpectation vs map[string][]byte)\n- Timeout configurability choices\n- Requirement granularity (9 requirements vs 6)\n\nAlready implemented: P7 file naming conventions, P9 requirement granularity ranges, golden example config infrastructure, advisory validateMeasureOutput.\n\nRemaining: create actual golden example file, upgrade validation to enforcing mode with retry, add temperature support.\n\nGitHub: petar-djukic/cobbler-scaffold#3","status":"closed","priority":2,"issue_type":"epic","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T21:35:18Z","created_by":"petardjukic","updated_at":"2026-02-24T21:46:22Z","closed_at":"2026-02-24T21:46:22Z","close_reason":"All children completed"}
{"id":"mage-90d.2","title":"Create golden example and document measure determinism","description":"deliverable_type: documentation\n\nrequired_reading:\n  - pkg/orchestrator/prompts/measure.yaml\n  - pkg/orchestrator/config.go (GoldenExample field)\n  - pkg/orchestrator/measure.go (buildMeasurePrompt)\n  - docs/specs/product-requirements/\n\nfiles:\n  - path: docs/engineering/golden-example-measure.yaml\n    action: create\n  - path: pkg/orchestrator/prompts/measure.yaml\n    action: modify\n\nrequirements:\n  - id: R1\n    text: Create an actual golden example YAML file showing an approved measure-issues.yaml output for a real utility, anchoring style, granularity, and naming conventions.\n  - id: R2\n    text: Document the golden_example config field usage and how operators provide their own examples.\n  - id: R3\n    text: Strengthen the measure prompt to explicitly instruct Claude to defer to PRD design decisions (file names, struct shapes, timeout config) rather than inventing them.\n\nacceptance_criteria:\n  - id: AC1\n    text: A golden example file exists that demonstrates the expected measure output format.\n  - id: AC2\n    text: The measure prompt explicitly tells Claude to look for and use design decisions from PRDs.\n  - id: AC3\n    text: mage analyze passes with no new issues.","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T21:35:54Z","created_by":"petardjukic","updated_at":"2026-02-24T21:38:30Z","closed_at":"2026-02-24T21:38:30Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-90d.2","depends_on_id":"mage-90d","type":"parent-child","created_at":"2026-02-24T16:35:54Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":10,"issue_id":"mage-90d.2","author":"petardjukic","text":"tokens: 25000","created_at":"2026-02-24T21:38:29Z"}]}
{"id":"mage-90d.3","title":"Upgrade measure validation to enforcing mode with retry","description":"deliverable_type: code\n\nrequired_reading:\n  - pkg/orchestrator/measure.go (validateMeasureOutput, RunMeasure)\n  - pkg/orchestrator/config.go (CobblerConfig)\n  - pkg/orchestrator/constitutions/planning.yaml (P7, P9)\n\nfiles:\n  - path: pkg/orchestrator/measure.go\n    action: modify\n  - path: pkg/orchestrator/config.go\n    action: modify\n  - path: pkg/orchestrator/measure_test.go\n    action: modify\n\nrequirements:\n  - id: R1\n    text: Change validateMeasureOutput from advisory (log warnings) to enforcing (return error) when EnforceMeasureValidation is true.\n  - id: R2\n    text: Add retry logic in RunMeasure that re-runs measure when validation fails, up to MaxMeasureRetries attempts.\n  - id: R3\n    text: Add EnforceMeasureValidation (bool) and MaxMeasureRetries (int) config fields to CobblerConfig.\n  - id: R4\n    text: Enforce P9 requirement granularity ranges and P7 file naming violations.\n  - id: R5\n    text: When retries are exhausted, accept the last result with a warning rather than failing the entire measure phase.\n\ndesign_decisions:\n  - id: DD1\n    text: EnforceMeasureValidation defaults to false for backward compatibility. When false, existing advisory behavior is preserved.\n  - id: DD2\n    text: MaxMeasureRetries defaults to 0 (no retries) when not set. A value of 2-3 is recommended.\n  - id: DD3\n    text: validateMeasureOutput returns (warnings []string, errors []string) to distinguish advisory from blocking issues.\n\nacceptance_criteria:\n  - id: AC1\n    text: With EnforceMeasureValidation=true, measure rejects issues that violate P9 granularity ranges.\n  - id: AC2\n    text: With MaxMeasureRetries=2, measure retries up to 2 times on validation failure.\n  - id: AC3\n    text: With EnforceMeasureValidation=false (default), existing advisory behavior is unchanged.\n  - id: AC4\n    text: Unit tests cover enforcing mode, retry logic, and backward-compatible advisory mode.\n  - id: AC5\n    text: go test ./pkg/orchestrator/... passes.","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T21:35:59Z","created_by":"petardjukic","updated_at":"2026-02-24T21:42:58Z","closed_at":"2026-02-24T21:42:58Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-90d.3","depends_on_id":"mage-90d","type":"parent-child","created_at":"2026-02-24T16:35:58Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":11,"issue_id":"mage-90d.3","author":"petardjukic","text":"tokens: 35000","created_at":"2026-02-24T21:42:58Z"}]}
{"id":"mage-90d.4","title":"Add temperature support to Claude invocation","description":"deliverable_type: code\n\nrequired_reading:\n  - pkg/orchestrator/commands.go (defaultClaudeArgs, runClaude)\n  - pkg/orchestrator/config.go (ClaudeConfig)\n\nfiles:\n  - path: pkg/orchestrator/commands.go\n    action: modify\n  - path: pkg/orchestrator/config.go\n    action: modify\n  - path: pkg/orchestrator/commands_test.go\n    action: create\n\nrequirements:\n  - id: R1\n    text: Investigate whether the Claude CLI supports a --temperature flag or equivalent parameter.\n  - id: R2\n    text: Add a Temperature field (float64) to ClaudeConfig.\n  - id: R3\n    text: Pass --temperature flag in Claude args when Temperature is explicitly set (non-zero).\n  - id: R4\n    text: Default Temperature to 0 (unset), meaning no flag is passed and Claude uses its default.\n\ndesign_decisions:\n  - id: DD1\n    text: Temperature 0.0 means \"not set\" (omit flag). To explicitly request temperature 0, use a very small value like 0.001, or add a separate TemperatureSet bool if needed.\n  - id: DD2\n    text: If Claude CLI does not support temperature, document the limitation and close the issue as won't-fix with an explanation.\n\nacceptance_criteria:\n  - id: AC1\n    text: Temperature field exists in ClaudeConfig and is loaded from configuration.yaml.\n  - id: AC2\n    text: When Temperature \u003e 0, the --temperature flag is included in Claude args.\n  - id: AC3\n    text: When Temperature is 0 (default), no temperature flag is passed.\n  - id: AC4\n    text: Unit tests verify arg construction with and without temperature.\n  - id: AC5\n    text: go test ./pkg/orchestrator/... passes.","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T21:36:03Z","created_by":"petardjukic","updated_at":"2026-02-24T21:44:43Z","closed_at":"2026-02-24T21:44:43Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-90d.4","depends_on_id":"mage-90d","type":"parent-child","created_at":"2026-02-24T16:36:02Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":12,"issue_id":"mage-90d.4","author":"petardjukic","text":"tokens: 20000. Claude CLI does not support --temperature flag as of 2026-02. Config field added and reserved for future use. Warning logged when set.","created_at":"2026-02-24T21:44:42Z"}]}
{"id":"mage-99k","title":"Implement code-to-spec traceability CodeLens (traceability.ts)","description":"deliverable_type: code\noutput: vscode-extension/src/traceability.ts\n\nRequired Reading:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (R9)\n- docs/specs/use-cases/rel02.0-uc006-specification-browser.yaml\n- vscode-extension/src/specModel.ts (SpecGraph for resolving tag to file path)\n- vscode-extension/src/extension.ts (how to register CodeLensProvider)\n\nFiles to Create/Modify:\n- vscode-extension/src/traceability.ts (create)\n- vscode-extension/src/extension.ts (register TraceabilityProvider for Go files)\n- vscode-extension/package.json (add 'mageOrchestrator.viewRequirement' command)\n\nRequirements:\n- TraceabilityProvider implements vscode.CodeLensProvider for language 'go'\n- Scans document lines for patterns: '// prd: \u003cprd-id\u003e \u003creq-id\u003e' and '// uc: \u003cuc-id\u003e'\n- Each match produces a CodeLens with title 'View Requirement' at that line\n- Clicking executes mageOrchestrator.viewRequirement command with the prd-id/uc-id argument\n- viewRequirement command resolves id to file path via SpecGraph, opens with vscode.window.showTextDocument\n- If id not found in SpecGraph, shows vscode.window.showWarningMessage('Spec not found: \u003cid\u003e')\n\nAcceptance Criteria:\n- CodeLens appears above each '// prd:' and '// uc:' comment in Go source files\n- Clicking 'View Requirement' opens the correct docs/specs/*.yaml file\n- Unknown ids show a warning message instead of an error\n- TraceabilityProvider registered in extension.ts activate()","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T13:46:06Z","created_by":"petardjukic","updated_at":"2026-02-23T18:12:50Z","closed_at":"2026-02-23T18:12:50Z","close_reason":"Closed"}
{"id":"mage-9q0","title":"Create rel02.0-uc004 Issue Tracker View use case","description":"deliverable_type: documentation\nformat_rule: use-case-format\noutput_path: docs/specs/use-cases/rel02.0-uc004-issue-tracker-view.yaml\n\nRequired Reading:\n- docs/constitutions/design.yaml (use-case-format rules)\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (R4: Issue Tracker, R5: Metrics Dashboard)\n- docs/specs/product-requirements/prd005-metrics-collection.yaml (InvocationRecord format)\n\nFiles to Create:\n- docs/specs/use-cases/rel02.0-uc004-issue-tracker-view.yaml\n\nSummary: Developer opens the issues view in VS Code and sees all beads issues grouped by status (open, in_progress, closed). Expanding an issue shows description, dependencies, and InvocationRecord metrics (tokens, LOC delta, duration) from issue comments. The view auto-refreshes when .beads/issues.jsonl changes.\n\nAcceptance Criteria:\n- use-case-format YAML at correct path\n- Covers issue listing, status grouping, InvocationRecord display, auto-refresh\n- Touchpoints reference prd006 R4 requirements\n- mage analyze passes","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T13:45:15Z","created_by":"petardjukic","updated_at":"2026-02-23T14:30:51Z","closed_at":"2026-02-23T14:30:51Z","close_reason":"Closed"}
{"id":"mage-9ud","title":"Parse required_reading and filter stitch source context","description":"deliverable_type: code\n\nrequired_reading:\n  - pkg/orchestrator/stitch.go (buildStitchPrompt, stitchTask, validateIssueDescription)\n  - pkg/orchestrator/context.go (buildProjectContext, loadSourceFiles, SourceFile type)\n  - pkg/orchestrator/config.go (ProjectConfig, CobblerConfig)\n  - pkg/orchestrator/prompt.go (StitchPromptDoc)\n  - docs/engineering/eng05-stitch-benchmark-analysis.md (recommendation D)\n\nfiles:\n  - path: pkg/orchestrator/stitch.go\n    action: modify\n    note: Parse required_reading from task.description YAML, pass filter to context builder\n  - path: pkg/orchestrator/context.go\n    action: modify\n    note: Add filterSourceFiles function, add optional source filter parameter to buildProjectContext or create buildStitchContext variant\n\nrequirements:\n  - id: R1\n    text: Parse required_reading list from the task description YAML in buildStitchPrompt. The field is a list of file paths (possibly with parenthetical notes).\n  - id: R2\n    text: Add filterSourceFiles(sources []SourceFile, requiredPaths []string) []SourceFile to context.go. Match source files by checking if any required path is a suffix of the source file path.\n  - id: R3\n    text: When required_reading contains source file paths (paths matching GoSourceDirs prefixes like pkg/, internal/, cmd/), filter ProjectContext.SourceCode to include only those files.\n  - id: R4\n    text: When required_reading is empty or contains no source file paths, preserve full source context (backward-compatible fallback).\n  - id: R5\n    text: Strip parenthetical notes from required_reading entries before matching (e.g., \"pkg/types/cupboard.go (CrumbTable interface)\" becomes \"pkg/types/cupboard.go\").\n  - id: R6\n    text: Log the number of source files before and after filtering for observability.\n\ndesign_decisions:\n  - id: D1\n    text: Filter source files after buildProjectContext returns, not inside it. This keeps buildProjectContext general-purpose for measure (which needs full context) while stitch filters post-hoc.\n  - id: D2\n    text: Use suffix matching for required_reading paths to handle both relative (pkg/foo.go) and absolute paths. A required path matches if any SourceFile.File ends with it.\n  - id: D3\n    text: Documentation files (specs, PRDs, architecture) are not filtered by required_reading. Only SourceCode is filtered, because docs are small and provide necessary project context.\n\nacceptance_criteria:\n  - id: AC1\n    text: When a task description contains required_reading with source file paths, only those source files appear in the stitch prompt ProjectContext.SourceCode.\n  - id: AC2\n    text: When required_reading is empty, all source files are included (no regression).\n  - id: AC3\n    text: Parenthetical notes in required_reading entries do not break file matching.\n  - id: AC4\n    text: Build succeeds with no new compiler errors.","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T20:57:25Z","created_by":"petardjukic","updated_at":"2026-02-24T21:08:03Z","closed_at":"2026-02-24T21:08:03Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-9ud","depends_on_id":"mage-65l","type":"blocks","created_at":"2026-02-24T15:57:29Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":6,"issue_id":"mage-9ud","author":"petardjukic","text":"tokens: 45000","created_at":"2026-02-24T21:08:02Z"}]}
{"id":"mage-9vl","title":"GH-5: Stitch: save log, stats, and code report on all exit paths","description":"Persist stitch history artifacts on all exit paths and add per-file stitch report.\n\nAC1-AC2 and AC4 are already implemented (failure-path log/stats saving, Status/Error fields in HistoryStats). Remaining work: AC3 (stitch-report.yaml with per-file diffstat) and AC5 (tests for failure-path saving and report generation).\n\nGitHub: petar-djukic/cobbler-scaffold#5","status":"closed","priority":2,"issue_type":"epic","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T20:23:17Z","created_by":"petardjukic","updated_at":"2026-02-24T20:40:11Z","closed_at":"2026-02-24T20:40:11Z","close_reason":"All children completed"}
{"id":"mage-9vl.1","title":"Add stitch report artifact with per-file diffstat","description":"deliverable_type: code\n\nrequired_reading:\n  - pkg/orchestrator/cobbler.go (HistoryStats, saveHistoryStats, saveHistoryLog, saveHistoryPrompt)\n  - pkg/orchestrator/stitch.go (doOneTask success path lines 469-494, gitDiffShortstat usage)\n  - pkg/orchestrator/gitops.go (existing git helpers, gitDiffShortstat)\n\nfiles:\n  - pkg/orchestrator/cobbler.go (add StitchReport struct, saveHistoryReport function)\n  - pkg/orchestrator/stitch.go (call saveHistoryReport from doOneTask success path)\n  - pkg/orchestrator/gitops.go (add gitDiffNameStatus helper)\n\nrequirements:\n  - R1: Add gitDiffNameStatus(ref) function that runs git diff --name-status against a ref and returns per-file entries (path, status, insertions, deletions)\n  - R2: Add StitchReport struct with fields task_id, task_title, status, branch, diff (aggregate), files (per-file list with path, status, insertions, deletions), loc_before, loc_after\n  - R3: Add saveHistoryReport(ts, report) function that writes {ts}-stitch-report.yaml to HistoryDir\n  - R4: Call saveHistoryReport from doOneTask success path after merge, before cleanup (around line 477 in stitch.go)\n  - R5: When HistoryDir is empty, saveHistoryReport must be a no-op (consistent with other save functions)\n\nacceptance_criteria:\n  - AC3 from GH-5: On successful stitch, {ts}-stitch-report.yaml is saved with file-level diffstat, LOC before/after, and task metadata\n  - Report YAML contains per-file breakdown (path, added/modified/deleted status, insertions, deletions)\n  - Existing stitch behavior is unchanged; only a new artifact is added","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T20:23:28Z","created_by":"petardjukic","updated_at":"2026-02-24T20:37:44Z","closed_at":"2026-02-24T20:37:44Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-9vl.1","depends_on_id":"mage-9vl","type":"parent-child","created_at":"2026-02-24T15:23:28Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":3,"issue_id":"mage-9vl.1","author":"petardjukic","text":"tokens: 45000","created_at":"2026-02-24T20:37:44Z"}]}
{"id":"mage-9vl.2","title":"Add stitch failure-path and report tests","description":"deliverable_type: code\n\nrequired_reading:\n  - pkg/orchestrator/stitch.go (doOneTask failure paths at lines 402-418, 424-441, 449-465)\n  - pkg/orchestrator/cobbler.go (saveHistoryStats, saveHistoryReport, StitchReport)\n  - pkg/orchestrator/gitops.go (gitDiffNameStatus)\n  - pkg/orchestrator/measure_test.go (if exists, for test patterns)\n\nfiles:\n  - pkg/orchestrator/cobbler_test.go (test report YAML generation and per-file diffstat parsing)\n\nrequirements:\n  - R1: Test that StitchReport struct serializes to expected YAML format with all fields\n  - R2: Test gitDiffNameStatus parsing of git diff --name-status output for added, modified, deleted, and renamed files\n  - R3: Test saveHistoryReport writes correct file to history directory\n  - R4: Test saveHistoryReport is a no-op when HistoryDir is empty\n\nacceptance_criteria:\n  - AC5 from GH-5: New tests cover report generation and per-file diffstat parsing\n  - All existing tests continue to pass\n  - Tests are runnable via go test ./pkg/orchestrator/...","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T20:23:37Z","created_by":"petardjukic","updated_at":"2026-02-24T20:39:04Z","closed_at":"2026-02-24T20:39:04Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-9vl.2","depends_on_id":"mage-9vl","type":"parent-child","created_at":"2026-02-24T15:23:36Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":4,"issue_id":"mage-9vl.2","author":"petardjukic","text":"tokens: 25000","created_at":"2026-02-24T20:39:04Z"}]}
{"id":"mage-a2j","title":"Implement generation browser tree view (generationBrowser.ts)","description":"deliverable_type: code\noutput: vscode-extension/src/generationBrowser.ts\n\nRequired Reading:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (R2: Generation Browser, R6: Config View)\n- docs/specs/use-cases/rel02.0-uc002-generation-browser.yaml\n- docs/specs/product-requirements/prd002-generation-lifecycle.yaml (tag naming: {prefix}*-start/finished/merged/abandoned)\n- vscode-extension/src/extension.ts (how to register TreeDataProvider)\n- vscode-extension/src/commands.ts (switch command for context menu)\n\nFiles to Create/Modify:\n- vscode-extension/src/generationBrowser.ts (create)\n- vscode-extension/src/extension.ts (register GenerationBrowserProvider for mage-orchestrator.status view)\n- vscode-extension/package.json (add context menu actions to view)\n\nRequirements:\n- GenerationBrowserProvider implements vscode.TreeDataProvider\u003cGenerationItem\u003e\n- Reads git tags via child_process.exec('git tag --list') to find generations\n- Derives lifecycle state from tag suffixes: has -start (created), has -finished (finished), has -merged (merged), has -abandoned (abandoned)\n- Shows version tag (v[REL].[DATE].[REVISION]) per generation if one exists\n- Current generation (active branch matches gen prefix) shows distinct icon (e.g., codicon 'play')\n- Child nodes show lifecycle tags and version tag\n- Context menu: 'Switch to Generation' calls mageOrchestrator.switch command\n- Refreshes via FileSystemWatcher on .git/refs/\n\nAcceptance Criteria:\n- Status view lists all generations with correct lifecycle state\n- Current generation distinguished visually\n- Version tags displayed when present\n- Switch context menu action triggers the switch command\n- Tree refreshes when .git/refs/ changes","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T13:46:19Z","created_by":"petardjukic","updated_at":"2026-02-23T18:18:53Z","closed_at":"2026-02-23T18:18:53Z","close_reason":"Closed"}
{"id":"mage-a8d","title":"Implement vscode:push and vscode:pop mage targets","description":"deliverable_type: code\n\nRequired Reading:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (R10)\n- magefiles/magefile.go (namespace pattern, scaffold:push/pop as model)\n- pkg/orchestrator/scaffold.go (push/pop implementation pattern)\n- pkg/orchestrator/commands.go (exec.Command wrappers)\n- vscode-extension/package.json (extension manifest)\n\nFiles to Create:\n- pkg/orchestrator/vscode.go (~120-180 lines)\n\nFiles to Modify:\n- magefiles/magefile.go (add Vscode namespace + Push/Pop methods, ~15 lines)\n- vscode-extension/package.json (add @vscode/vsce to devDependencies)\n\nRequirements:\n1. Create pkg/orchestrator/vscode.go with VscodePush() and VscodePop() methods on Orchestrator\n2. VscodePush flow: verify npm and code CLI exist -\u003e npm install in vscode-extension/ -\u003e npm run compile -\u003e npx @vscode/vsce package --no-dependencies -\u003e code --install-extension \u003cvsix path\u003e\n3. VscodePop flow: code --uninstall-extension mesh-intelligence.mage-orchestrator\n4. Log each step via logf() with timestamps\n5. Return actionable error messages when npm or code CLI is missing\n6. Add Vscode mg.Namespace to magefiles/magefile.go with Push() and Pop() methods following the scaffold namespace pattern\n7. Add @vscode/vsce to vscode-extension/package.json devDependencies\n\nDesign Decisions:\n- Use exec.Command directly (consistent with commands.go pattern) rather than shell invocation\n- The vscode-extension/ directory path is derived from the orchestrator repo root (os.Getwd), not from Config\n- vsix filename is derived from package.json name and version fields\n- Push always rebuilds from source (no caching)\n\nAcceptance Criteria:\n- mage vscode:push compiles the extension and installs it into VS Code\n- mage vscode:pop uninstalls the extension from VS Code\n- Both targets appear in mage -l output under the Vscode namespace\n- Push fails with clear error if npm is not installed\n- Push fails with clear error if code CLI is not installed\n- Pop is idempotent (succeeds even if extension is not installed)\n- mage analyze passes\n- go vet ./... passes","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T14:17:35Z","created_by":"petardjukic","updated_at":"2026-02-23T14:41:27Z","closed_at":"2026-02-23T14:41:27Z","close_reason":"Closed"}
{"id":"mage-ahl","title":"Create rel02.0-uc003 Branch Comparison use case","description":"deliverable_type: documentation\nformat_rule: use-case-format\noutput_path: docs/specs/use-cases/rel02.0-uc003-branch-comparison.yaml\n\nRequired Reading:\n- docs/constitutions/design.yaml (use-case-format rules)\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (R3: Branch and Tag Comparison)\n- docs/specs/product-requirements/prd002-generation-lifecycle.yaml (tag naming conventions)\n\nFiles to Create:\n- docs/specs/use-cases/rel02.0-uc003-branch-comparison.yaml\n\nSummary: Developer selects two version tags (v[REL].[DATE].[REV]) from a quick-pick list and sees a file-level summary of changes between them. Each changed file is clickable to open a VS Code diff editor. Developer can also compare two generation branches.\n\nAcceptance Criteria:\n- use-case-format YAML at correct path\n- Covers tag selection, file summary, diff editor launch, generation branch comparison\n- Touchpoints reference prd006 R3 requirements\n- mage analyze passes","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T13:45:22Z","created_by":"petardjukic","updated_at":"2026-02-23T14:27:56Z","closed_at":"2026-02-23T14:27:56Z","close_reason":"Closed"}
{"id":"mage-bfv","title":"Update planning constitution for explicit task splitting","description":"deliverable_type: documentation\n\nrequired_reading:\n  - pkg/orchestrator/constitutions/planning.yaml (P2 task sizing, P6 decomposition)\n  - docs/constitutions/planning.yaml (mirror copy)\n  - docs/engineering/eng05-stitch-benchmark-analysis.md (recommendation A)\n\nfiles:\n  - path: pkg/orchestrator/constitutions/planning.yaml\n    action: modify\n    note: Strengthen P2 for explicit implementation/test splitting\n  - path: docs/constitutions/planning.yaml\n    action: modify\n    note: Mirror the same changes\n\nrequirements:\n  - id: R1\n    text: Update P2 to explicitly mandate splitting implementation and test tasks. Each feature should be decomposed as (1) types/interfaces, (2) implementation, (3) tests.\n  - id: R2\n    text: Add guidance that each task must be completable within the Claude timeout (typically 5-10 minutes). If a task requires more than 20 turns, it is too large.\n  - id: R3\n    text: Both copies (pkg/orchestrator/constitutions/planning.yaml and docs/constitutions/planning.yaml) must be identical.\n\nacceptance_criteria:\n  - id: AC1\n    text: P2 explicitly says to split implementation and test tasks.\n  - id: AC2\n    text: P2 includes timeout-awareness guidance.\n  - id: AC3\n    text: Both files are identical.","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T20:58:10Z","created_by":"petardjukic","updated_at":"2026-02-24T21:05:26Z","closed_at":"2026-02-24T21:05:26Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-bfv","depends_on_id":"mage-65l","type":"blocks","created_at":"2026-02-24T15:58:13Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":5,"issue_id":"mage-bfv","author":"petardjukic","text":"tokens: 25000","created_at":"2026-02-24T21:05:22Z"}]}
{"id":"mage-bhc","title":"Create rel02.0-uc002 Generation Browser use case","description":"deliverable_type: documentation\nformat_rule: use-case-format\noutput_path: docs/specs/use-cases/rel02.0-uc002-generation-browser.yaml\n\nRequired Reading:\n- docs/constitutions/design.yaml (use-case-format rules)\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (R2: Generation Browser Tree View)\n- docs/specs/use-cases/rel02.0-uc001-lifecycle-commands.yaml (example)\n- docs/specs/product-requirements/prd002-generation-lifecycle.yaml (lifecycle states)\n\nFiles to Create:\n- docs/specs/use-cases/rel02.0-uc002-generation-browser.yaml\n\nSummary: Developer opens VS Code status view and sees a tree of all generations derived from git tags. Each generation shows lifecycle state (-start, -finished, -merged, -abandoned), version tags, and highlights the current branch. Developer can switch to a generation from the tree context menu.\n\nAcceptance Criteria:\n- use-case-format YAML at correct path\n- Covers listing generations, showing lifecycle state, current branch indicator, switch action\n- Touchpoints reference prd006 R2 requirements\n- mage analyze passes","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T13:45:14Z","created_by":"petardjukic","updated_at":"2026-02-23T14:09:26Z","closed_at":"2026-02-23T14:09:26Z","close_reason":"Closed"}
{"id":"mage-bsd","title":"GH-8: Support VSCode profile targeting in mage vscode:push","description":"mage vscode:push installs the extension into the default VSCode profile. Users working in custom profiles (e.g., \"GO\") cannot access the extension after installation because VSCode isolates extensions per profile.\n\nAcceptance Criteria:\n- mage vscode:push accepts an optional profile name parameter (e.g., mage vscode:push GO)\n- When no profile is specified, installs to the default profile with a message indicating how to specify a profile\n- The extension is available in the targeted profile immediately after installation\n\nGitHub: petar-djukic/cobbler-scaffold#8","status":"closed","priority":2,"issue_type":"epic","owner":"petar.djukic@gmail.com","created_at":"2026-02-25T03:18:51Z","created_by":"petardjukic","updated_at":"2026-02-25T03:25:04Z","closed_at":"2026-02-25T03:25:04Z","close_reason":"All children completed"}
{"id":"mage-bsd.2","title":"Update prd006 with profile targeting requirement","description":"Required Reading:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml\n\nFiles to Modify:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml\n\nRequirements:\n- Add R10.6 requirement: vscode:push and vscode:pop accept an optional profile name parameter\n- When profile is provided, pass --profile \u003cname\u003e to the code CLI\n- When profile is empty, install to the default profile and log how to specify a profile\n\nAcceptance Criteria:\n- prd006 R10 section includes R10.6 for profile targeting\n- mage analyze passes after the change","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-25T03:19:01Z","created_by":"petardjukic","updated_at":"2026-02-25T03:23:04Z","closed_at":"2026-02-25T03:23:04Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-bsd.2","depends_on_id":"mage-bsd","type":"parent-child","created_at":"2026-02-24T22:19:01Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":13,"issue_id":"mage-bsd.2","author":"petardjukic","text":"tokens: 5000","created_at":"2026-02-25T03:23:03Z"}]}
{"id":"mage-bsd.3","title":"Add profile parameter to VscodePush and VscodePop","description":"Required Reading:\n- pkg/orchestrator/vscode.go\n- pkg/orchestrator/vscode_test.go\n- magefiles/magefile.go\n\nFiles to Modify:\n- pkg/orchestrator/vscode.go\n- pkg/orchestrator/vscode_test.go\n- magefiles/magefile.go\n\nRequirements:\n- VscodePush(profile string) passes --profile \u003cname\u003e to code --install-extension when non-empty\n- VscodePop(profile string) passes --profile \u003cname\u003e to code --uninstall-extension when non-empty\n- When profile is empty, log a message about how to specify a profile\n- Mage targets updated: func (Vscode) Push(profile string) and func (Vscode) Pop(profile string)\n- Unit tests for command argument construction with and without profile\n\nAcceptance Criteria:\n- mage vscode:push GO installs to the GO profile\n- mage vscode:push \"\" installs to default profile with info message\n- mage vscode:pop GO uninstalls from GO profile\n- mage test:unit passes\n- mage analyze passes","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-25T03:19:08Z","created_by":"petardjukic","updated_at":"2026-02-25T03:24:51Z","closed_at":"2026-02-25T03:24:51Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-bsd.3","depends_on_id":"mage-bsd","type":"parent-child","created_at":"2026-02-24T22:19:07Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":14,"issue_id":"mage-bsd.3","author":"petardjukic","text":"tokens: 8000","created_at":"2026-02-25T03:24:51Z"}]}
{"id":"mage-cds","title":"Implement metrics dashboard webview","description":"Replace the placeholder 'not yet implemented' message for mageOrchestrator.showDashboard with a WebviewPanel displaying generation metrics. Should show token usage, lines of code deltas, issue throughput, and cycle timing from beads data. Depends on beads JSONL parser (mage-p2y).","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T20:01:04Z","created_by":"petardjukic","updated_at":"2026-02-24T19:29:36Z","closed_at":"2026-02-24T19:29:36Z","close_reason":"Closed","comments":[{"id":1,"issue_id":"mage-cds","author":"petardjukic","text":"tokens: 80000","created_at":"2026-02-24T19:29:36Z"}]}
{"id":"mage-fzl","title":"Implement extension infrastructure and lifecycle commands","description":"deliverable_type: code\noutput: vscode-extension/src/\n\nRequired Reading:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (R1: Lifecycle Commands, R7: Infrastructure)\n- docs/specs/use-cases/rel02.0-uc001-lifecycle-commands.yaml\n- vscode-extension/src/extension.ts (current stub)\n- vscode-extension/package.json (current commands and views)\n\nFiles to Create/Modify:\n- vscode-extension/src/extension.ts (replace stub with real activate/deactivate)\n- vscode-extension/src/commands.ts (all lifecycle commands)\n- vscode-extension/package.json (register all commands and views)\n\nRequirements:\n- activate() registers all commands, tree providers, watchers, output channel\n- Commands: mageOrchestrator.start, .run, .resume, .stop, .reset, .switch, .cobblerMeasure, .cobblerStitch\n- Each command executes the corresponding mage target in an integrated terminal (vscode.window.createTerminal)\n- Start, Stop, Reset show confirmation dialogs (vscode.window.showWarningMessage)\n- Switch shows quick-pick of generation branches from git branch list\n- deactivate() disposes all watchers, terminals, subscriptions\n- Output channel named 'Mage Orchestrator' for error logging\n- FileSystemWatcher on .beads/, .git/refs/, configuration.yaml\n\nAcceptance Criteria:\n- All commands appear in Command Palette when configuration.yaml exists\n- Each command runs the correct mage target in integrated terminal\n- Destructive commands show confirmation dialog\n- Switch shows branch quick-pick\n- Extension activates only when configuration.yaml present (workspaceContains)\n- mage test:unit passes (TypeScript compilation via tsc)","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T13:45:35Z","created_by":"petardjukic","updated_at":"2026-02-23T16:26:00Z","closed_at":"2026-02-23T16:26:00Z","close_reason":"Closed"}
{"id":"mage-h5b","title":"Add context budget config and truncation","description":"deliverable_type: code\n\nrequired_reading:\n  - pkg/orchestrator/config.go (CobblerConfig, applyDefaults)\n  - pkg/orchestrator/context.go (buildProjectContext, ProjectContext, SourceFile)\n  - pkg/orchestrator/stitch.go (buildStitchPrompt, where context is serialized)\n  - docs/engineering/eng05-stitch-benchmark-analysis.md (recommendation D, context budget)\n\nfiles:\n  - path: pkg/orchestrator/config.go\n    action: modify\n    note: Add MaxContextBytes field to CobblerConfig with default\n  - path: pkg/orchestrator/context.go\n    action: modify\n    note: Add applyContextBudget function that truncates source files when serialized context exceeds budget\n  - path: pkg/orchestrator/stitch.go\n    action: modify\n    note: Wire context budget enforcement into buildStitchPrompt after selective filtering\n\nrequirements:\n  - id: R1\n    text: Add MaxContextBytes int field to CobblerConfig with yaml tag \"max_context_bytes\". Default to 200000 (approximately 50K tokens at 4 bytes/token) in applyDefaults.\n  - id: R2\n    text: Add applyContextBudget(ctx *ProjectContext, budget int, requiredPaths []string) that measures the YAML-serialized size of ProjectContext and, if it exceeds budget, progressively removes SourceCode entries not in requiredPaths until within budget.\n  - id: R3\n    text: Remove source files in reverse order (last loaded first) to preserve files closer to the top of the directory tree.\n  - id: R4\n    text: Log context size before and after budget enforcement, and the number of source files removed.\n  - id: R5\n    text: Wire applyContextBudget into buildStitchPrompt after selective filtering from sub-issue 1 (or after buildProjectContext if sub-issue 1 is not yet merged).\n  - id: R6\n    text: When MaxContextBytes is 0, skip budget enforcement (backward-compatible).\n\ndesign_decisions:\n  - id: D1\n    text: Measure context size by YAML-marshaling the ProjectContext struct. This matches what actually gets injected into the prompt.\n  - id: D2\n    text: Only truncate SourceCode, not documentation. Documentation is small relative to source code and provides necessary design context.\n  - id: D3\n    text: Progressive removal (one file at a time, re-measure) is simpler than trying to estimate per-file sizes. If performance matters later, cache per-file sizes.\n\nacceptance_criteria:\n  - id: AC1\n    text: When ProjectContext exceeds MaxContextBytes, source files not in required_reading are removed until within budget.\n  - id: AC2\n    text: When MaxContextBytes is 0, no truncation occurs.\n  - id: AC3\n    text: Context size before and after is logged.\n  - id: AC4\n    text: Build succeeds with no new compiler errors.","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T20:57:44Z","created_by":"petardjukic","updated_at":"2026-02-24T21:09:57Z","closed_at":"2026-02-24T21:09:57Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-h5b","depends_on_id":"mage-65l","type":"blocks","created_at":"2026-02-24T15:57:48Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":7,"issue_id":"mage-h5b","author":"petardjukic","text":"tokens: 55000","created_at":"2026-02-24T21:09:57Z"}]}
{"id":"mage-n7y","title":"Implement branch and tag comparison view","description":"Implement a view that compares branches and tags for generation cycles. Should show diff stats between generation branches (e.g., files changed, lines added/removed) and allow navigating to changed files. Specified in rel02.0-uc003 branch comparison use case.","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T20:00:58Z","created_by":"petardjukic","updated_at":"2026-02-24T19:37:05Z","closed_at":"2026-02-24T19:37:05Z","close_reason":"Closed","comments":[{"id":2,"issue_id":"mage-n7y","author":"petardjukic","text":"tokens: 45000","created_at":"2026-02-24T19:37:05Z"}]}
{"id":"mage-p2y","title":"Implement beads JSONL parser and InvocationRecord extraction","description":"Parse .beads/issues.jsonl to extract InvocationRecord data for display in the extension. The file watcher for .beads/** already exists in extension.ts but has no backing parser. Implement a JSONL parser that reads beads issue data and exposes it as a typed interface for consumption by tree views and the metrics dashboard.","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T20:00:47Z","created_by":"petardjukic","updated_at":"2026-02-24T19:16:07Z","closed_at":"2026-02-24T19:16:07Z","close_reason":"Closed"}
{"id":"mage-qh3","title":"E2E test for selective stitch context","description":"deliverable_type: code\n\nrequired_reading:\n  - pkg/orchestrator/stitch.go (RunStitchN, doOneTask, buildStitchPrompt)\n  - pkg/orchestrator/context.go (buildProjectContext, filterSourceFiles)\n  - tests/ (existing E2E test patterns)\n  - pkg/orchestrator/config.go (Config, CobblerConfig)\n\nfiles:\n  - path: tests/e2e/stitch_context_test.go\n    action: create\n    note: E2E test that runs measure+stitch and validates selective context and compilation\n\nrequirements:\n  - id: R1\n    text: Create an E2E test that sets up a minimal project structure with docs, specs, and source files.\n  - id: R2\n    text: Run measure to generate tasks, then run stitch to execute one task.\n  - id: R3\n    text: Verify that stitch uses selective context when required_reading is present in the task description.\n  - id: R4\n    text: Verify that the output compiles (go build succeeds on the modified project).\n  - id: R5\n    text: Verify that context size is within MaxContextBytes budget.\n\ndesign_decisions:\n  - id: D1\n    text: Use a test fixture directory with a minimal Go project and spec structure, not the full cobbler-scaffold repo.\n  - id: D2\n    text: The E2E test may use mocks or short Claude timeouts to keep test duration reasonable. If Claude is unavailable, the test should be skipped (not failed).\n\nacceptance_criteria:\n  - id: AC1\n    text: E2E test exists and is runnable via mage test:e2e.\n  - id: AC2\n    text: Test validates that measure+stitch produces compiling code for at least 1 task.\n  - id: AC3\n    text: Test validates selective context filtering is active (context size is reduced compared to full context).","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-24T20:58:26Z","created_by":"petardjukic","updated_at":"2026-02-24T21:20:31Z","closed_at":"2026-02-24T21:20:31Z","close_reason":"Closed","dependencies":[{"issue_id":"mage-qh3","depends_on_id":"mage-65l","type":"blocks","created_at":"2026-02-24T15:58:29Z","created_by":"petardjukic","metadata":"{}"}],"comments":[{"id":9,"issue_id":"mage-qh3","author":"petardjukic","text":"tokens: 80000","created_at":"2026-02-24T21:20:30Z"}]}
{"id":"mage-u4p","title":"Add R8 Specification Browser and R9 Code-to-Spec Traceability to prd006","description":"deliverable_type: documentation\nformat_rule: prd-format (update existing)\noutput_path: docs/specs/product-requirements/prd006-vscode-extension.yaml\n\nRequired Reading:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (full)\n- docs/ARCHITECTURE.yaml\n- docs/constitutions/design.yaml (prd-format rules)\n\nFiles to Modify:\n- docs/specs/product-requirements/prd006-vscode-extension.yaml\n\nRequirements:\nR8 - Specification Browser: tree panel listing use cases (docs/specs/use-cases/*.yaml). Each use case node expands to PRD touchpoints; each requirement node expands to source files matching grep of PRD ID in pkg/. Clicking any node opens the corresponding YAML or source file. Top-level groups for PRDs and test suites. Refreshes via FileSystemWatcher on docs/specs/.\n\nR9 - Code-to-Spec Traceability: CodeLensProvider for Go source files. Detects comments with pattern '// prd: \u003cprd-id\u003e \u003creq-id\u003e' and '// uc: \u003cuc-id\u003e'. Each tag renders a 'View Requirement' CodeLens that opens the referenced spec YAML.\n\nAcceptance Criteria:\n- R8 and R9 added to prd006 in correct prd-format structure\n- R8 describes spec tree view with navigation from use case to requirement to source\n- R9 defines tagging convention and CodeLens behavior\n- mage analyze passes after update","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T13:44:51Z","created_by":"petardjukic","updated_at":"2026-02-23T13:55:01Z","closed_at":"2026-02-23T13:55:01Z","close_reason":"Closed"}
{"id":"mage-zh8","title":"Create rel02.0-uc006 Specification Browser use case","description":"deliverable_type: documentation\nformat_rule: use-case-format\noutput_path: docs/specs/use-cases/rel02.0-uc006-specification-browser.yaml\n\nRequired Reading:\n- docs/constitutions/design.yaml (use-case-format rules)\n- docs/specs/product-requirements/prd006-vscode-extension.yaml (R8 and R9, added by mage-u4p)\n- docs/specs/use-cases/rel02.0-uc001-lifecycle-commands.yaml (example use case)\n- docs/road-map.yaml (add uc006 to rel02.0 release)\n\nFiles to Create/Modify:\n- docs/specs/use-cases/rel02.0-uc006-specification-browser.yaml (create)\n- docs/road-map.yaml (add uc006 entry to rel02.0)\n\nRequired Sections (use-case-format):\nid, title, summary, actor, trigger, flow, touchpoints (linking to prd006 R8/R9), success_criteria, out_of_scope, dependencies, risks\n\nSummary: A developer opens the Specification Browser panel in VS Code and navigates from a use case to its PRD requirements, and from a requirement to the source files implementing it. Conversely, the developer opens a Go source file containing a prd: or uc: tag and uses the CodeLens to jump directly to the referenced spec document.\n\nAcceptance Criteria:\n- use-case-format YAML created at correct path\n- Covers both directions: spec-to-code and code-to-spec\n- Touchpoints reference prd006 R8 and R9\n- road-map.yaml updated with uc006 entry under rel02.0\n- mage analyze passes","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-23T13:45:02Z","created_by":"petardjukic","updated_at":"2026-02-23T14:26:28Z","closed_at":"2026-02-23T14:26:28Z","close_reason":"Closed"}
