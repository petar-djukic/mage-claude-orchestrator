# Copyright (c) 2026 Petar Djukic. All rights reserved.
# SPDX-License-Identifier: MIT

id: specifications-cobbler-scaffold
title: Cobbler Scaffold Specifications

overview: |
  We build a Go library that automates AI-driven code generation through a
  two-phase cobbler workflow: measure proposes tasks, stitch executes them in
  isolated git worktrees. This document indexes every PRD, use case, and test
  suite in the project and shows how they trace to each other. For goals and
  boundaries see VISION.yaml. For components and interfaces see ARCHITECTURE.yaml.

roadmap_summary:
  - version: "01.0"
    name: Core Orchestrator and Workflows
    use_cases_done: 5
    use_cases_total: 5
    status: done

  - version: "02.0"
    name: VS Code Extension
    use_cases_done: 0
    use_cases_total: 5
    status: not started

  - version: "99.0"
    name: Unscheduled
    use_cases_done: 0
    use_cases_total: 0
    status: not started

prd_index:
  - id: prd001-orchestrator-core
    title: Orchestrator Core Interface
    summary: Defines the Config struct, constructor, defaults, YAML loading, and initialization for consuming projects
    path: specs/product-requirements/prd001-orchestrator-core.yaml

  - id: prd002-generation-lifecycle
    title: Generation Lifecycle Management
    summary: Defines generation branch naming, start, run, resume, stop, reset, list, and switch operations
    path: specs/product-requirements/prd002-generation-lifecycle.yaml

  - id: prd003-cobbler-workflows
    title: Cobbler Measure and Stitch Workflows
    summary: Defines the measure and stitch phases, prompt templates, Claude invocation, and recovery
    path: specs/product-requirements/prd003-cobbler-workflows.yaml

  - id: prd005-metrics-collection
    title: Metrics Collection and Reporting
    summary: Defines InvocationRecord, LOC snapshots, stats collection, and token parsing
    path: specs/product-requirements/prd005-metrics-collection.yaml

  - id: prd006-vscode-extension
    title: VS Code Extension
    summary: Defines generation browser, issue tracker, and metrics dashboard for VS Code (not started)
    path: specs/product-requirements/prd006-vscode-extension.yaml

use_case_index:
  - id: rel01.0-uc001-orchestrator-initialization
    title: Orchestrator Initialization and Configuration
    release: "01.0"
    status: done
    path: specs/use-cases/rel01.0-uc001-orchestrator-initialization.yaml

  - id: rel01.0-uc002-generation-lifecycle
    title: Generation Lifecycle from Start to Stop
    release: "01.0"
    status: done
    path: specs/use-cases/rel01.0-uc002-generation-lifecycle.yaml

  - id: rel01.0-uc003-measure-workflow
    title: Measure Workflow Task Proposal
    release: "01.0"
    status: done
    path: specs/use-cases/rel01.0-uc003-measure-workflow.yaml

  - id: rel01.0-uc004-stitch-workflow
    title: Stitch Workflow Task Execution
    release: "01.0"
    status: done
    path: specs/use-cases/rel01.0-uc004-stitch-workflow.yaml

  - id: rel01.0-uc005-resume-recovery
    title: Generation Resume and Task Recovery
    release: "01.0"
    status: done
    path: specs/use-cases/rel01.0-uc005-resume-recovery.yaml

test_suite_index:
  - id: test-rel01.0
    title: Release 01.0 test suite
    release: rel01.0
    traces:
      - rel01.0-uc001-orchestrator-initialization
      - rel01.0-uc002-generation-lifecycle
      - rel01.0-uc003-measure-workflow
      - rel01.0-uc004-stitch-workflow
      - rel01.0-uc005-resume-recovery
    test_case_count: 31
    path: specs/test-suites/test-rel01.0.yaml

  - id: test-rel02.0
    title: Release 02.0 test suite
    release: rel02.0
    traces:
      - rel02.0-uc001-lifecycle-commands
    test_case_count: 9
    path: specs/test-suites/test-rel02.0.yaml

prd_to_use_case_mapping:
  - use_case: rel01.0-uc001-orchestrator-initialization
    prd: prd001-orchestrator-core
    why_required: Validates Config struct, constructor defaults, and Init method
    coverage: R1, R2, R5

  - use_case: rel01.0-uc002-generation-lifecycle
    prd: prd002-generation-lifecycle
    why_required: Exercises generation start, run, stop, and list operations
    coverage: R2, R3, R5, R7

  - use_case: rel01.0-uc003-measure-workflow
    prd: prd001-orchestrator-core
    why_required: Uses Config workflow fields for measure configuration
    coverage: R1 (partial)

  - use_case: rel01.0-uc003-measure-workflow
    prd: prd003-cobbler-workflows
    why_required: Validates measure phase - prompt rendering, Claude invocation, issue import
    coverage: R1, R2, R5, R6, R7

  - use_case: rel01.0-uc003-measure-workflow
    prd: prd005-metrics-collection
    why_required: Records InvocationRecord on each created issue
    coverage: R1 (partial)

  - use_case: rel01.0-uc004-stitch-workflow
    prd: prd001-orchestrator-core
    why_required: Uses Config workflow fields for stitch configuration
    coverage: R1 (partial)

  - use_case: rel01.0-uc004-stitch-workflow
    prd: prd003-cobbler-workflows
    why_required: Validates stitch phase - worktree isolation, Claude execution, merge, close
    coverage: R1, R3, R4, R6

  - use_case: rel01.0-uc004-stitch-workflow
    prd: prd005-metrics-collection
    why_required: Records InvocationRecord with LOC snapshots and diff stats
    coverage: R1, R2, R5

  - use_case: rel01.0-uc005-resume-recovery
    prd: prd002-generation-lifecycle
    why_required: Exercises resume and branch resolution logic
    coverage: R4, R9

  - use_case: rel01.0-uc005-resume-recovery
    prd: prd003-cobbler-workflows
    why_required: Exercises stale task recovery and orphaned issue reset
    coverage: R4

traceability_diagram: |
  graph LR
      subgraph PRDs
          prd1["prd001\norchestrator-core"]
          prd2["prd002\ngeneration-lifecycle"]
          prd3["prd003\ncobbler-workflows"]
          prd5["prd005\nmetrics-collection"]
          prd6["prd006\nvscode-extension"]
      end

      subgraph UseCases["Use Cases"]
          uc1["rel01.0-uc001\ninitialization"]
          uc2["rel01.0-uc002\ngeneration-lifecycle"]
          uc3["rel01.0-uc003\nmeasure-workflow"]
          uc4["rel01.0-uc004\nstitch-workflow"]
          uc5["rel01.0-uc005\nresume-recovery"]
      end

      subgraph TestSuites["Test Suites"]
          ts1["test-uc001\ninitialization"]
          ts2["test-uc002\ngeneration-lifecycle"]
          ts3["test-uc003\nmeasure-workflow"]
          ts4["test-uc004\nstitch-workflow"]
          ts5["test-uc005\nresume-recovery"]
      end

      uc1 --> prd1
      uc2 --> prd2
      uc3 --> prd1
      uc3 --> prd3
      uc3 --> prd5
      uc4 --> prd1
      uc4 --> prd3
      uc4 --> prd5
      uc5 --> prd2
      uc5 --> prd3

      ts1 --> uc1
      ts2 --> uc2
      ts3 --> uc3
      ts4 --> uc4
      ts5 --> uc5

coverage_gaps: |
  We identify the following gaps in specification coverage:

  - prd005-metrics-collection has no dedicated use case. We exercise it
    indirectly through uc003 (measure) and uc004 (stitch), which record
    InvocationRecords. A dedicated use case would provide more thorough
    validation.

  - prd006-vscode-extension has no use cases or test suites. This PRD belongs
    to release 02.0, which has not started. Five use cases are planned in
    road-map.yaml but their YAML files do not exist yet.

  - No prd004 exists. The PRD numbering skips from prd003 to prd005.

  - rel02.0 use cases (uc001 through uc005) are listed in road-map.yaml but
    have no corresponding files in docs/specs/use-cases/.

references:
  - VISION.yaml
  - ARCHITECTURE.yaml
  - road-map.yaml
